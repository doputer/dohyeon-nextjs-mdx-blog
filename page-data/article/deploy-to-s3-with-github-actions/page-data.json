{"componentChunkName":"component---src-templates-blog-post-js","path":"/article/deploy-to-s3-with-github-actions/","result":{"data":{"site":{"siteMetadata":{"title":"DOPUTER","author":"김도현","siteUrl":"https://dohyeon.dev","comment":{"disqusShortName":"","utterances":"doputer/blog-comments"},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"cc339e9d-3ce1-5d61-bca5-e59b6bf7e7cd","excerpt":"GitHub Actions 란?  는 GitHub에서 제공하는 CI/CD 툴이다. 다시 말해서 Workflow를 자동화할 수 있게 도와준다. GitHub Actions에 관해서는 다른 글에서 자세하게 다루도록 하고, 이 글에서는 내가 AWS S3에 배포 자동화를 하는 과정과 그 과정에서 발생한 문제를 해결하는 것에 관한 글을 쓰려고한다. 1. AWS IAM 우선 AWS IAM…","html":"<h2 id=\"github-actions-란\" style=\"position:relative;\"><a href=\"#github-actions-%EB%9E%80\" aria-label=\"github actions 란 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>GitHub Actions 란?</h2>\n<p><code class=\"language-text\">GitHub Actions</code> 는 GitHub에서 제공하는 CI/CD 툴이다. 다시 말해서 Workflow를 자동화할 수 있게 도와준다.</p>\n<p>GitHub Actions에 관해서는 다른 글에서 자세하게 다루도록 하고, 이 글에서는 내가 AWS S3에 배포 자동화를 하는 과정과 그 과정에서 발생한 문제를 해결하는 것에 관한 글을 쓰려고한다.</p>\n<h2 id=\"1-aws-iam\" style=\"position:relative;\"><a href=\"#1-aws-iam\" aria-label=\"1 aws iam permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. AWS IAM</h2>\n<p>우선 AWS IAM 설정을 해줘야한다.</p>\n<p><code class=\"language-text\">AWS IAM -> 액세스 관리 -> 사용자 -> 사용자 추가</code></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1200px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABUUlEQVQoz5VT0XKCMBDk/3+tM/0CtaUKCihCEoJAkm32MB112ofezM5Kktvc3sVsGAZorWGtRYoQwu+Iez4EOfO27fD+0XEF0zxjWRZB1vc92rbF9XoVOOfwZ9yFGcPNwU5O1rz3P8jO5zOIqqpQlqWIaq2gVQ9ext+9GdGaGdPiRJCJkHqDVPzoIuMmq+KHMUbEjb0J7G3CEu3M8xJtOTmXzpPDS3sY2asr7wN669CoOVry+G9ktHi5XO5W9doq71ZLtOcWqWiWSldM0/TEHAaZ57K6rpHnOXa7HTabDQ6HAz7zL1krjids9xVOTSvt0NoIK6XkcvK6rtF1HcZxXC3zBk6albaxUjNYlEWBum6wL444nirweamYSAEOK/HjcxPLqZmPwUGs02+iaBWTBrmdyWSKExTl99OUXx8vg71hKyhKThbTn4Bgz2mTeymP/A0cIgp6lyQKyAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"AWS\"\n        title=\"AWS\"\n        src=\"/static/ff56e3bd22ab96201c2ad89b35e1397f/c1b63/1.png\"\n        srcset=\"/static/ff56e3bd22ab96201c2ad89b35e1397f/5a46d/1.png 300w,\n/static/ff56e3bd22ab96201c2ad89b35e1397f/0a47e/1.png 600w,\n/static/ff56e3bd22ab96201c2ad89b35e1397f/c1b63/1.png 1200w,\n/static/ff56e3bd22ab96201c2ad89b35e1397f/d61c2/1.png 1800w,\n/static/ff56e3bd22ab96201c2ad89b35e1397f/c9d77/1.png 1964w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>사용자 이름을 추가하고, <code class=\"language-text\">AWS 액세스 유형 선택에서 액세스 키 - 프로그래밍 방식 액세스</code> 를 선택한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1200px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.333333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABcklEQVQoz3VS2U7DMBDM/38SHwDPFYLS0kKTJrFzOnaO2qnjwWvREoFYaeTJ7mQPr6NpmqCUwjiOcM6B7Haube270cd9i22qPFtg5hnLsiAyxqBpGmitg4icv5P8JHOBL4sLXE0zRn0NFeg/ikVSSnDOQZ1ScmstyEcdUxGtL7hog6ejxGc1IW0vSIVB1V9DUgIVuBWNyrJEHMcYhiEkpUBVVRBCoO979P46hknj4bXDJlHYZR0OlQZX9rvnHwsjS6lQ+gS3CnY18lp4H9fD2iWA/DQR+WgimizKeI23YwKW5ygLjoIzVGXhFyUDqMOmrpHnmddk4CwPGtITCn9dnDG87/eovS4qmw7HU4zN8zO2HxkOCcMp5Tiz8o4kL8J5PKV43R0CP5zO2Lxs8ZGkXs8QZxxtpxANhrZl0PpO0s4i72aIaYHU7g/E5OO1hBivgbOmRyEGNL1B5+OXq6NnoyHa1i+hg7Pz/Xn8D6w0+PXt8AXWd7XReTMQKQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"AWS\"\n        title=\"AWS\"\n        src=\"/static/eb13b0ef7a1610c300a2ee74d5f040ef/c1b63/2.png\"\n        srcset=\"/static/eb13b0ef7a1610c300a2ee74d5f040ef/5a46d/2.png 300w,\n/static/eb13b0ef7a1610c300a2ee74d5f040ef/0a47e/2.png 600w,\n/static/eb13b0ef7a1610c300a2ee74d5f040ef/c1b63/2.png 1200w,\n/static/eb13b0ef7a1610c300a2ee74d5f040ef/d61c2/2.png 1800w,\n/static/eb13b0ef7a1610c300a2ee74d5f040ef/263f4/2.png 1996w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><code class=\"language-text\">권한 설정에서 기존 정책 직접 연결</code> 을 선택하고, <code class=\"language-text\">AmazonS3FullAccess</code> 를 선택한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1200px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABRUlEQVQoz42Sy3KEIBBF/f8vym9kl4njKzriiKKg+ADlpkWTmuyyOHW6uy6FIME0agxygCbD4X8c2h02u8EYezTIG423d45gNBrSDJj3BaszWEG49cJcrH99ZZb9YPH1aGbU44CgWQWSPkNap3h2TxQ8RyUYnn0F1pYomwfNGar2sjhmhfcJAyO4rDFYiWDeZyjdI0w+EeeRJylizz0LERUZ4oohLArcy8fJ46w/s8TnszKFnHooS1+o6LhyVYTEQPVoR+9fqFdWe6Q5PXgmb2UUFK0/1kmqg67rkNPurRDYHV30vpOJ/ZXN464/4ijn3JlzV79d2aBtW6RfGZI4AeccvOanX6FZwxtEUYQwDFGWJRhjno/bDXle+JxoBYLFrBBjj0lPsNbSMzDer/zM+r5HXdcQdJrjZFrTNSi6pmmhJ3RmvwFop2Td4NYOEgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"AWS\"\n        title=\"AWS\"\n        src=\"/static/db468e0770c56c503bb443ae40daca50/c1b63/3.png\"\n        srcset=\"/static/db468e0770c56c503bb443ae40daca50/5a46d/3.png 300w,\n/static/db468e0770c56c503bb443ae40daca50/0a47e/3.png 600w,\n/static/db468e0770c56c503bb443ae40daca50/c1b63/3.png 1200w,\n/static/db468e0770c56c503bb443ae40daca50/d61c2/3.png 1800w,\n/static/db468e0770c56c503bb443ae40daca50/e53e8/3.png 1982w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>뒤로 넘기다가 완료가 되면 <code class=\"language-text\">.csv 다운로드</code> 를 선택해서 액세스 키를 다운로드 한다.</p>\n<blockquote>\n<p>비밀 키는 다시 다운로드 할 수 없고 분실한 경우 새로 발급 받아야한다!</p>\n</blockquote>\n<h2 id=\"2-github-secrets\" style=\"position:relative;\"><a href=\"#2-github-secrets\" aria-label=\"2 github secrets permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. GitHub Secrets</h2>\n<p><code class=\"language-text\">GitHub repository -> Settings -> Secrets -> New repository secret</code></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1200px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABB0lEQVQoz32RiWoDMQxE9/8/s7QJLSRen/K505GStA2BGgat1vKzxtr2EBFiNpXaUNug+ovkH9l+7ehjYnt7P+F0/sLH+RMpCwsGwf1FdrBPapi0Tuxy1t/V+H9LvcDXiF0CXPGoo0HXcRy/Yj7nhA8BMambhEo3uw+4uB3iI/LVYa6FLbeCKAmxZiSqNOHGfAZScy7kXFBEUIqwm2554AWNsfISAyrI5d268xJx5fdgN7rWE3Ai8lAuhU+TabVZp44zUJjs4QZUiKfdncBLcgQ6i32OH+uPGHhYLaf0B0jbBnT+Bmyj27vV3iC9mjTXTe1wreMeFxoHo1ZVgxNVqPAtB2OXajXfstkhxn+BVTQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"AWS\"\n        title=\"AWS\"\n        src=\"/static/b99b8184f5550a7a6cbc7de4ac810e4a/c1b63/4.png\"\n        srcset=\"/static/b99b8184f5550a7a6cbc7de4ac810e4a/5a46d/4.png 300w,\n/static/b99b8184f5550a7a6cbc7de4ac810e4a/0a47e/4.png 600w,\n/static/b99b8184f5550a7a6cbc7de4ac810e4a/c1b63/4.png 1200w,\n/static/b99b8184f5550a7a6cbc7de4ac810e4a/29007/4.png 1600w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>AWS IAM에서 발급한 액세스 키 ID와 비밀 액세스 키를 등록한다.</p>\n<h2 id=\"3-github-actions\" style=\"position:relative;\"><a href=\"#3-github-actions\" aria-label=\"3 github actions permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. GitHub Actions</h2>\n<p><code class=\"language-text\">GitHub repository -> Actions -> set up a workflow yourself</code></p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token comment\"># main-deploy.yml</span>\n\n<span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Deploy to Production\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">push</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">branches</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> main\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">deploy</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span><span class=\"token number\">18.04</span>\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Checkout source code\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@master\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Cache node modules\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/cache@v1\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> node_modules\n          <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> runner.OS <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">-</span>build<span class=\"token punctuation\">-</span>$<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> hashFiles('<span class=\"token important\">**/package-lock.json')</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token key atrule\">restore-keys</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n            ${{ runner.OS }}-build-\n            ${{ runner.OS }}-</span>\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Install Dependencies\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm install\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm run build\n\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Deploy\n        <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">AWS_ACCESS_KEY_ID</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.AWS_ACCESS_KEY_ID <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n          <span class=\"token key atrule\">AWS_SECRET_ACCESS_KEY</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.AWS_SECRET_ACCESS_KEY <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          aws s3 cp \\\n            --recursive \\\n            --region ap-northeast-2 \\\n            build s3://S3-Bucket-Name</span></code></pre></div>\n<blockquote>\n<p>제일 밑에 S3-Bucket-Name에는 본인의 Bucket 이름을 적으면 된다!</p>\n</blockquote>\n<h2 id=\"4-배포-테스트\" style=\"position:relative;\"><a href=\"#4-%EB%B0%B0%ED%8F%AC-%ED%85%8C%EC%8A%A4%ED%8A%B8\" aria-label=\"4 배포 테스트 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 배포 테스트</h2>\n<p>이제 main 브랜치에 푸시를 하면 자동으로 배포가 된다.</p>\n<p>라고 생각했지만 나는 안됐다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1200px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 9.333333333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAaUlEQVQI103NSw6AIAwEUO9/TRUxkY9YjAJlhLrQJpN2MXkd1DhB6RWL1pjVAuc9mBkpZ+SWfnOtoPvd9Zc+BxHCQbhTQmndwRiLzVoY6+Cch98DKEZJjCdKKQKFq4H8YYIL2LunPO7gA/ypm5aC0fYDAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"AWS\"\n        title=\"AWS\"\n        src=\"/static/3886deefe93a412ae1c4d51e3a7fa27f/c1b63/5.png\"\n        srcset=\"/static/3886deefe93a412ae1c4d51e3a7fa27f/5a46d/5.png 300w,\n/static/3886deefe93a412ae1c4d51e3a7fa27f/0a47e/5.png 600w,\n/static/3886deefe93a412ae1c4d51e3a7fa27f/c1b63/5.png 1200w,\n/static/3886deefe93a412ae1c4d51e3a7fa27f/d61c2/5.png 1800w,\n/static/3886deefe93a412ae1c4d51e3a7fa27f/e216b/5.png 1904w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>원인 분석을 위해 실패가 발생한 항목에 들어가서 로그를 확인해봤다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1200px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA40lEQVQY04WRaY6DMAyFc5fptKVAEtYQIIWytNP7H+jVNmI00mw/nl7kxJ+XqEhXaMKCMD/hhxX+uiB3AackxzHOxHcdIoO3sxb/TYqBLswI0xNVO6Ib70jzBrGtEekSSeZEMWkH/iXFSa6f0N8+oAv/qYSgpmw3GMEvpsL7xf4r6dBWHYrmClv3ci79IGOzczwnZXS3g3kCXbTi/F5T4b24OqeFgDiJAwwx1KGlB7bsBLSBh2186wTKeYcf9qkcLXutOyyU1BP0fntgHR+YaA0z7XahT/LUSUOwr17TZOaUftMLfdy91gtwEnUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"AWS\"\n        title=\"AWS\"\n        src=\"/static/e455106437973889bdcccba7b63da260/c1b63/7.png\"\n        srcset=\"/static/e455106437973889bdcccba7b63da260/5a46d/7.png 300w,\n/static/e455106437973889bdcccba7b63da260/0a47e/7.png 600w,\n/static/e455106437973889bdcccba7b63da260/c1b63/7.png 1200w,\n/static/e455106437973889bdcccba7b63da260/61946/7.png 1546w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 936px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 8.333333333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAeElEQVQI1z3LzQ6CMBAEYN5FSdADGKz8bHG3tFAi4vs/ztjtgcNksplvi37ykPULchEkK2xqWXZ0doZu2iMvGN4BHD45hhymectWje7PgdEYQsHp+ZVAZ30GChWRRJhRMnTxgN9+sGnjsKPtGddbg/L+OKP3parxB6fcQ7n0yPSNAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"AWS\"\n        title=\"AWS\"\n        src=\"/static/6060e5fc7168c1fd30273298746692e7/6d2da/8.png\"\n        srcset=\"/static/6060e5fc7168c1fd30273298746692e7/5a46d/8.png 300w,\n/static/6060e5fc7168c1fd30273298746692e7/0a47e/8.png 600w,\n/static/6060e5fc7168c1fd30273298746692e7/6d2da/8.png 936w\"\n        sizes=\"(max-width: 936px) 100vw, 936px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><code class=\"language-text\">process.env.CI</code> 가 true 설정되어 있어서 경고들이 오류로 간주된다는 내용이었다. 이 부분을 해결하기 위해 위에서 작성한 <code class=\"language-text\">main-deploy.yml</code> 을 수정했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token comment\"># 수정 전</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build\n  <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm run build\n\n<span class=\"token comment\"># 수정 후</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build\n  <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm run build\n  <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">CI</span><span class=\"token punctuation\">:</span> <span class=\"token string\">''</span></code></pre></div>\n<p>이제 GitHub Action이 정상적으로 작동한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1200px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 9%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAbUlEQVQI12XM3Q6DIAyGYe//LveHGnXAMsRBy7viyQ7WtEm/pH0G50buD8c0z7hx4nK9EUJEVRFRoLEXJVfbW7P+jYgQ4ot3StRaz59h3Z4s64Y3xPtAz/E82vmUQq9kYEf/QAM6mPOBWlZtfAHT6ptKVlRA2gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"AWS\"\n        title=\"AWS\"\n        src=\"/static/266651cd63ffd284ae24caff46a7daff/c1b63/6.png\"\n        srcset=\"/static/266651cd63ffd284ae24caff46a7daff/5a46d/6.png 300w,\n/static/266651cd63ffd284ae24caff46a7daff/0a47e/6.png 600w,\n/static/266651cd63ffd284ae24caff46a7daff/c1b63/6.png 1200w,\n/static/266651cd63ffd284ae24caff46a7daff/d61c2/6.png 1800w,\n/static/266651cd63ffd284ae24caff46a7daff/8963a/6.png 1918w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<h2 id=\"환경변수-설정\" style=\"position:relative;\"><a href=\"#%ED%99%98%EA%B2%BD%EB%B3%80%EC%88%98-%EC%84%A4%EC%A0%95\" aria-label=\"환경변수 설정 permalink\" class=\"anchor-header before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>환경변수 설정</h2>\n<p>위에서 언급한 과정으로 GitHub Actions를 이용할 수 있지만 환경 변수를 적용하려면 어떻게 해야할까?</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1200px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABB0lEQVQoz32RiWoDMQxE9/8/s7QJLSRen/K505GStA2BGgat1vKzxtr2EBFiNpXaUNug+ovkH9l+7ehjYnt7P+F0/sLH+RMpCwsGwf1FdrBPapi0Tuxy1t/V+H9LvcDXiF0CXPGoo0HXcRy/Yj7nhA8BMambhEo3uw+4uB3iI/LVYa6FLbeCKAmxZiSqNOHGfAZScy7kXFBEUIqwm2554AWNsfISAyrI5d268xJx5fdgN7rWE3Ai8lAuhU+TabVZp44zUJjs4QZUiKfdncBLcgQ6i32OH+uPGHhYLaf0B0jbBnT+Bmyj27vV3iC9mjTXTe1wreMeFxoHo1ZVgxNVqPAtB2OXajXfstkhxn+BVTQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"AWS\"\n        title=\"AWS\"\n        src=\"/static/b99b8184f5550a7a6cbc7de4ac810e4a/c1b63/4.png\"\n        srcset=\"/static/b99b8184f5550a7a6cbc7de4ac810e4a/5a46d/4.png 300w,\n/static/b99b8184f5550a7a6cbc7de4ac810e4a/0a47e/4.png 600w,\n/static/b99b8184f5550a7a6cbc7de4ac810e4a/c1b63/4.png 1200w,\n/static/b99b8184f5550a7a6cbc7de4ac810e4a/29007/4.png 1600w\"\n        sizes=\"(max-width: 1200px) 100vw, 1200px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p>빌드 파일에서 사용할 환경 변수를 GitHub Secrets에 등록해준다. 나는 ReactJS에서 서버에 요청하는 BASE_URL이 개발 환경과 배포 환경에서 각각 달랐기 때문에 이걸로 예를 들어보려고 한다.</p>\n<p><code class=\"language-text\">main-deploy.yml</code> 을 다시 한번 수정해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token comment\"># 수정 전</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build\n  <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm run build\n  <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">CI</span><span class=\"token punctuation\">:</span> <span class=\"token string\">''</span>\n\n<span class=\"token comment\"># 수정 후</span>\n<span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Build\n  <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> npm run build\n  <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">CI</span><span class=\"token punctuation\">:</span> <span class=\"token string\">''</span>\n    <span class=\"token key atrule\">REACT_APP_SERVER_BASE_URL</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.REACT_APP_SERVER_BASE_URL <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code></pre></div>","tableOfContents":"<ul>\n<li><a href=\"/article/deploy-to-s3-with-github-actions/#github-actions-%EB%9E%80\">GitHub Actions 란?</a></li>\n<li><a href=\"/article/deploy-to-s3-with-github-actions/#1-aws-iam\">1. AWS IAM</a></li>\n<li><a href=\"/article/deploy-to-s3-with-github-actions/#2-github-secrets\">2. GitHub Secrets</a></li>\n<li><a href=\"/article/deploy-to-s3-with-github-actions/#3-github-actions\">3. GitHub Actions</a></li>\n<li><a href=\"/article/deploy-to-s3-with-github-actions/#4-%EB%B0%B0%ED%8F%AC-%ED%85%8C%EC%8A%A4%ED%8A%B8\">4. 배포 테스트</a></li>\n<li><a href=\"/article/deploy-to-s3-with-github-actions/#%ED%99%98%EA%B2%BD%EB%B3%80%EC%88%98-%EC%84%A4%EC%A0%95\">환경변수 설정</a></li>\n</ul>","frontmatter":{"title":"GitHub Actions로 AWS S3 배포 자동화 하기 ⚙️"}}},"pageContext":{"slug":"/article/deploy-to-s3-with-github-actions/","previous":{"fields":{"slug":"/project/wysiwyg-draft-js/"},"frontmatter":{"title":"WYSIWYG 에디터 draft.js의 기록 👀"}},"next":{"fields":{"slug":"/article/running-service-with-pm2/"},"frontmatter":{"title":"PM2로 서비스 운영하기 🚙"}}}}}
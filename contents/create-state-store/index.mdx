---
emoji: 'ğŸ«™'
title: 'ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë§Œë“¤ì–´ë³´ê¸°'
description: 'ë°”í€´ë¥¼ ì¬ë°œëª… í•´ë´…ì‹œë‹¤'
tags:
  - react
  - zustand
date: 2025-10-29
---

import Example1 from '#/create-state-store/example/example1';
import Example2 from '#/create-state-store/example/example2';
import Example3 from '#/create-state-store/example/example3';
import Example4 from '#/create-state-store/example/example4';

ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ ë™ì‘ ì›ë¦¬ë¥¼ ì´í•´í•˜ëŠ” ë°©ë²•ì—ëŠ” ì–´ë–¤ ê²ƒë“¤ì´ ìˆì„ê¹Œìš”? ì—¬ëŸ¬ê°€ì§€ê°€ ìˆê² ì§€ë§Œ ë‹¤ì‹œ ë§Œë“¤ì–´ë³´ëŠ” ê²ƒë„ ê·¸ ì¤‘ í•˜ë‚˜ë¼ê³  ìƒê°í•©ë‹ˆë‹¤.

ìì£¼ ì‚¬ìš©í•˜ëŠ” ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¤‘ í•˜ë‚˜ì¸ `Zustand`ë¥¼ ì§ì ‘ ë§Œë“¤ì–´ë³´ë©´ì„œ ì–´ë–¤ ë¬¸ì œë¥¼ í•´ê²°í•´ë‚˜ê°”ëŠ”ì§€ ìƒê°ì„ ë”°ë¼ê°€ë´¤ìŠµë‹ˆë‹¤.

## Zustandì˜ ë™ì‘ ë°©ì‹

`Zustand`ëŠ” ì–´ë–»ê²Œ ë™ì‘í•˜ê³ , ë˜ `React`ëŠ” ì–´ë–»ê²Œ ìƒíƒœë¥¼ ì „ë‹¬ë°›ì„ ìˆ˜ ìˆì„ê¹Œìš”?

ê°„ë‹¨íˆ ë§í•˜ìë©´ `React`ëŠ” `Zustand`ê°€ ë§Œë“  ìƒíƒœ ì €ì¥ì†Œë¥¼ `useSyncExternalStore`ë¥¼ í†µí•´ êµ¬ë…í•˜ëŠ” êµ¬ì¡°ì…ë‹ˆë‹¤.

1. `Zustand`ê°€ ìƒíƒœ ì €ì¥ì†Œ ìƒì„±
2. `React`ê°€ `useSyncExternalStore`ë¡œ ìƒíƒœ ì €ì¥ì†Œ êµ¬ë…
3. ìƒíƒœê°€ ë³€ê²½ë˜ë©´ `Zustand`ê°€ ëª¨ë“  êµ¬ë…ìì—ê²Œ ì•Œë¦¼
4. `React`ê°€ ë³€ê²½ì„ ê°ì§€í•˜ê³  ì»´í¬ë„ŒíŠ¸ë¥¼ ë¦¬ë Œë”ë§

í”Œë¡œìš° ì°¨íŠ¸ë¡œëŠ” ì•„ë˜ì™€ ê°™ì´ í‘œí˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```mermaid
flowchart TD
  A["Zustand"] --Create--> B["Store"]
  B --Notify--> C["Component"]
  C --Subscribe--> B

  A["Zustand"] --Create--> D["Store"]
  D --Notify--> E["Component"]
  E --Subscribe--> D
```

ì´ì œ ì´ íë¦„ì„ ì½”ë“œë¡œ í‘œí˜„í•´ë³´ê² ìŠµë‹ˆë‹¤.

## ê¸°ë³¸ ìƒíƒœ ì €ì¥ì†Œ

ê°€ì¥ ë¨¼ì € ìµœì†Œí•œì˜ ê¸°ëŠ¥ë§Œ ê°€ì§„ ë‹¨ìˆœí•œ ì €ì¥ì†Œë¥¼ ë§Œë“¤ì–´ë³´ê² ìŠµë‹ˆë‹¤.

ìš°ì„  ì•„ë˜ ì„¸ ê°€ì§€ ì¸í„°í˜ì´ìŠ¤ë¥¼ ê°–ëŠ” ì €ì¥ì†Œë¥¼ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.

1. ê°’ì„ ë°˜í™˜í•  ìˆ˜ ìˆë‹¤.
2. ê°’ì„ ë³€ê²½í•  ìˆ˜ ìˆë‹¤.
3. ê°’ì´ ë³€ê²½ëìŒì„ ì•Œë¦´ ìˆ˜ ìˆë‹¤.

```ts basic-store.ts
type Store<T> = {
  getState: () => T;
  setState: (value: T) => void;
  subscribe: (listener: () => void) => () => void;
};

export const createStore = <T>(initialState: T) => {
  let state = initialState;
  const listeners = new Set<() => void>();

  const getState: Store<T>['getState'] = () => {
    return state;
  };

  const setState: Store<T>['setState'] = (value) => {
    const nextState = value;

    if (Object.is(nextState, state)) return;

    state = nextState;

    listeners.forEach((listener) => listener());
  };

  const subscribe: Store<T>['subscribe'] = (listener) => {
    listeners.add(listener);

    return () => listeners.delete(listener);
  };

  return { getState, setState, subscribe };
};
```

`createStore` í•¨ìˆ˜ëŠ” ìš”êµ¬ ì‚¬í•­ëŒ€ë¡œ ì„¸ ê°€ì§€ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

ìƒê°ë³´ë‹¤ ë‹¨ìˆœí•œ êµ¬ì¡°ì¸ë°ìš”. í•œê°€ì§€ íŠ¹ì§•ì€ ë‚´ë¶€ì— ìˆëŠ” `state`ëŠ” ë…¸ì¶œí•˜ì§€ ì•Šê³ , ëŒ€ì‹  í´ë¡œì €ë¥¼ ì´ìš©í•´ì„œ ì•ˆì „í•˜ê²Œ ê´€ë¦¬í•©ë‹ˆë‹¤.

ì´ì œ ì´ ì €ì¥ì†Œë¥¼ `React`ê°€ êµ¬ë…í•  ìˆ˜ ìˆë„ë¡ ë§Œë“¤ê² ìŠµë‹ˆë‹¤.

ê³µì‹ ë¬¸ì„œì˜ [useSyncExternalStore](https://ko.react.dev/reference/react/useSyncExternalStore)ë¥¼ ì½ì–´ë³´ë©´, `subscribe` í•¨ìˆ˜ëŠ” ìŠ¤í† ì–´ë¥¼ êµ¬ë…í•˜ê³ , êµ¬ë…ì„ ì·¨ì†Œí•˜ëŠ” í•¨ìˆ˜ë¥¼ ë°˜í™˜í•´ì•¼í•˜ê³ , `getSnapshot` í•¨ìˆ˜ëŠ” ìŠ¤í† ì–´ì—ì„œ ë°ì´í„°ì˜ ìŠ¤ëƒ…ìƒ·ì„ ì½ì–´ì™€ì•¼í•œë‹¤ê³  ë˜ì–´ìˆìŠµë‹ˆë‹¤.

ì´ì— ë§ê²Œ ë©”ì†Œë“œë“¤ì„ ë„£ì–´ì¤ë‹ˆë‹¤.

```ts basic-store.ts
export const useStore = <T>(store: Store<T>) => {
  const slice = useSyncExternalStore(store.subscribe, store.getState);

  return slice;
};
```

ì´ì œ ì €ì¥ì†ŒëŠ” ìƒíƒœê°€ ë³€ê²½ë˜ë©´ `React`ì— ì•Œë¦¬ê²Œ ë˜ê³ , `React`ëŠ” ìƒˆë¡œìš´ ìƒíƒœ ìŠ¤ëƒ…ìƒ·ì„ `Object.is`ë¡œ ë¹„êµí•´ì„œ ë³€ê²½ë˜ì—ˆì„ ë•Œ ì»´í¬ë„ŒíŠ¸ë¥¼ ë¦¬ë Œë”ë§í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

ë²Œì¨ ê¸°ë³¸ ìƒíƒœ ì €ì¥ì†Œë¥¼ ì™„ì„±í–ˆëŠ”ë°ìš”. ì´ì œ ì´ê±¸ ì´ìš©í•´ì„œ ê°„ë‹¨í•œ ì¹´ìš´í„° ì»´í¬ë„ŒíŠ¸ë¥¼ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í•´ë³´ê² ìŠµë‹ˆë‹¤.

```tsx Counter.tsx
const store = createStore(0);

const Counter = () => {
  const value = useStore(store);

  const increase = () => {
    store.setState(store.getState() + 1);
  };

  return (
    <>
      <div>Value: {value}</div>
      <button onClick={increase}>Increase Button</button>
    </>
  );
};
```

<Callout>
    `Increase Button`ì„ ëˆŒëŸ¬ì„œ ë³€í™”ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.
</Callout>

<Example1 />

### í•¨ìˆ˜í˜• ìƒíƒœ ì—…ë°ì´íŠ¸

ê¸°ì¡´ ì €ì¥ì†ŒëŠ” ì˜ ë™ì‘í•˜ì§€ë§Œ ìƒˆë¡œìš´ ê°’ì„ ì§ì ‘ ì „ë‹¬í•˜ëŠ” ë°©ì‹ë§Œ ì§€ì›í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ì „ ìƒíƒœë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë‹¤ìŒ ìƒíƒœë¥¼ ê³„ì‚°í•´ì•¼ í•˜ëŠ” ê²½ìš°ë„ ìì£¼ ìˆëŠ”ë°ìš”.

ì˜ˆë¥¼ ë“¤ì–´ `setState(state + 1)` ëŒ€ì‹  `setState((prev) => prev + 1)`ì²˜ëŸ¼ ì‘ì„±í•  ìˆ˜ ìˆìœ¼ë©´ ë” ì§ê´€ì ì…ë‹ˆë‹¤.

ì´ë¥¼ ìœ„í•´ `setState` í•¨ìˆ˜ë¥¼ ì•„ë˜ì²˜ëŸ¼ í™•ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```ts primitive-store.ts
const setState: Store<T>['setState'] = (value) => {
  // !mark(1:4)
  const nextState =
    typeof value === "function"
      ? (value as (state: T) => T)(state)
      : value;

  if (Object.is(nextState, state)) return;

  state = nextState;

  listeners.forEach((listener) => listener());
};
```

ì´ì œ ì•„ë˜ì™€ ê°™ì´ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx Counter.tsx
const increase = () => {
  store.setState(prev => prev + 1);
};
```

## íš¨ìœ¨ì ì¸ ìƒíƒœ ì €ì¥ì†Œ

ê¸°ì¡´ ì €ì¥ì†ŒëŠ” ìƒíƒœë¥¼ ë³€ê²½í•  ë•Œë§ˆë‹¤ ëª¨ë“  êµ¬ë…ìì—ê²Œ ì•Œë¦½ë‹ˆë‹¤. ì›ì‹œ ê°’ì¼ ë• ë¬¸ì œê°€ ì—†ì§€ë§Œ ê°ì²´ë¥¼ ë‹¤ë£° ë•ŒëŠ” ë¶ˆí•„ìš”í•œ ë Œë”ë§ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê¸°ì¡´ ì €ì¥ì†Œì— ê°ì²´ë¥¼ ì €ì¥í•˜ê³  ê°ì²´ì˜ ì¼ë¶€ë§Œ ë³€ê²½í•´ë³´ê² ìŠµë‹ˆë‹¤. `age`ê°€ ë³€ê²½ë˜ë©´ `name`ë§Œ êµ¬ë…í•˜ê³  ìˆëŠ” ì»´í¬ë„ŒíŠ¸ë„ ë¦¬ë Œë”ë§ ë©ë‹ˆë‹¤.

```tsx Person.tsx
const store = createStore({
  name: 'ê¹€ë„í˜„',
  age: 0,
});

const Name = () => {
  const { name } = useStore(store);

  return <div>Name: {name}</div>;
};

const Age = () => {
  const { age } = useStore(store);

  const increase = () => {
    store.setState((prev) => ({ ...prev, age: prev.age + 1 }));
  };

  return (
    <>
      <div>Age: {age}</div>
      <button onClick={increase}>Increase Button</button>
    </>
  );
};
```

<Example2 />

`Name` ì»´í¬ë„ŒíŠ¸ë¥¼ `React.memo`ë¡œ ê°ì‹¸ë„ ë™ì¼í•˜ê²Œ ë¦¬ë Œë”ë§ ë˜ëŠ”ë°ìš”. ë¦¬ë Œë”ë§ì´ ì™œ ë°œìƒí•˜ëŠ”ì§€ ìƒê°í•´ë³´ë©´ ì†Œìš©ì´ ì—†ë‹¤ëŠ” ê±¸ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ìœ ëŠ” ë¦¬ë Œë”ë§ íŠ¸ë¦¬ê±°ê°€ `Name` ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì—ì„œ ë°œìƒí•˜ëŠ”ê²Œ ì•„ë‹ˆë¼ `useSyncExternalStore`ì—ì„œ ë°œìƒí•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. í˜„ì¬ ì €ì¥ì†Œê°€ ì „ì²´ ê°ì²´ë¥¼ êµ¬ë…í•˜ê³  ìˆì–´ì„œ `age`ë§Œ ë°”ë€Œì–´ë„ ê°ì²´ ì°¸ì¡°ê°€ ìƒˆë¡œì›Œì§€ê³ , `Name` ì»´í¬ë„ŒíŠ¸ë„ í•¨ê»˜ ë¦¬ë Œë”ë§ ë©ë‹ˆë‹¤.

ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ `selector` ê°œë…ì„ ë„ì…í•´ë³´ê² ìŠµë‹ˆë‹¤. í•µì‹¬ì€ **`useSyncExternalStore`ê°€ í˜„ì¬ ìƒíƒœë¥¼ ì½ëŠ” í•¨ìˆ˜(getSnapshot)ì˜ ê²°ê³¼ë¥¼ ê¸°ì–µí•œë‹¤ëŠ” ì **ì…ë‹ˆë‹¤. ë”°ë¼ì„œ **ë¬´ì—‡ì„ êµ¬ë…í• ì§€**ë§Œ ì¡°ì ˆí•´ì£¼ë©´ ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ì„ ë§‰ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```ts selective-store.ts
type Selector<T, U = T> = (state: T) => U;

export const useStore = <T, U = T>(
  store: Store<T>,
  selector: Selector<T, U> = (state) => state as unknown as U
) => {
  const slice = useSyncExternalStore(
    store.subscribe,
    () => selector(store.getState()),
    () => selector(store.getState())
  );

  return slice;
};
```

<Callout>
    **ì œë„¤ë¦­ íƒ€ì… `U`**

    `selector`ëŠ” ê°ì²´ì—ì„œ ì¼ë¶€ë§Œ ì„ íƒí•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì´ë•Œ íƒ€ì…ì„ ì•ˆì „í•˜ê²Œ ì¶”ë¡ í•˜ê¸° ìœ„í•´ì„œ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

    `T`ëŠ” `Store`ì—ì„œ ì¶”ë¡ ë˜ê³  `U`ëŠ” `Selector`ì—ì„œ ì¶”ë¡ ë©ë‹ˆë‹¤.

    ```ts
    useStore(store) // T = { name: string; age: number }, U = T
    useStore(store, (state) => state.name) // T = { name: string; age: number }, U = string
    ```
</Callout>

ì´ì œ ì»´í¬ë„ŒíŠ¸ì—ì„œ ê°ì²´ì˜ ì›í•˜ëŠ” ê°’ë§Œ ì˜ë¼ì„œ êµ¬ë…í•  ìˆ˜ ìˆê³ , ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ë„ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

```tsx Person.tsx
const store = createStore({
  name: 'ê¹€ë„í˜„',
  age: 0,
});

const Name = () => {
  const name = useStore(store, (state) => state.name);

  return <div>Name: {name}</div>;
};

const Age = () => {
  const age = useStore(store, (state) => state.age);

  const increase = () => {
    store.setState((prev) => ({ ...prev, age: prev.age + 1 }));
  };

  return (
    <>
      <div>Age: {age}</div>
      <button onClick={increase}>Increase Button</button>
    </>
  );
};
```

<Example3 />

## ìµœì í™”ëœ ìƒíƒœ ì €ì¥ì†Œ

`selector`ë¥¼ ì¶”ê°€í•˜ë©´ì„œ ì´ì œ í•„ìš”í•œ ë¶€ë¶„ë§Œ êµ¬ë…í•  ìˆ˜ ìˆëŠ” ì €ì¥ì†Œê°€ ë˜ì—ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì—¬ì „íˆ ë¬¸ì œê°€ ë‚¨ì•„ìˆëŠ”ë°ìš”.

```ts
useStore(store, (state) => ({ name: state.name, age: state.age }));
```

ì´ë ‡ê²Œ ì—¬ëŸ¬ ê°’ì„ ê°ì²´ë¡œ ë¬¶ì–´ì„œ ë°˜í™˜í•˜ë©´ ê°ì²´ì˜ ì°¸ì¡°ê°€ ë§¤ë²ˆ ìƒˆë¡œ ìƒì„±ë¼ì„œ ë¬´í•œ ë¦¬ë Œë”ë§ì´ ë°œìƒí•©ë‹ˆë‹¤.

`React`ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì°¸ì¡° ë™ë“±ì„±(Object.is)ìœ¼ë¡œ ìƒíƒœ ë³€í™”ë¥¼ ê°ì§€í•˜ê¸° ë•Œë¬¸ì— ë‹¤ë¥¸ ìƒˆë¡œìš´ ê°ì²´ê°€ ë§Œë“¤ì–´ì§ˆ ë•Œë§ˆë‹¤ `useSyncExternalStore`ëŠ” "ê°’ì´ ë‹¬ë¼ì¡Œë‹¤" ë¼ê³  í‰ê°€í•©ë‹ˆë‹¤.

ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ `shallow` ê°œë…ì„ ë„ì…í•´ë³´ê² ìŠµë‹ˆë‹¤. `React`ì˜ ì½”ë“œë¥¼ ë°”ê¿€ ìˆ˜ëŠ” ì—†ëŠ” ë…¸ë¦‡ì´ë‹ˆ ì»´í¬ë„ŒíŠ¸ì—ì„œ ê°ì²´ì˜ ê°’ì´ ë°”ë€Œì§€ ì•Šì•˜ë‹¤ë©´ ë™ì¼í•œ ì°¸ì¡°ë¥¼ ê°€ì§„ ê°ì²´ë¥¼ ì „ë‹¬í•´ì£¼ë©´ ë©ë‹ˆë‹¤.

```ts use-shallow.ts
const equal = <T>(value1: T, value2: T) => {
  if (JSON.stringify(value1) === JSON.stringify(value2)) return true;

  return false;
};

export const useShallow = <T, U = T>(selector: Selector<T, U>) => {
  const prev = useRef<U>(null);

  return (state: T) => {
    const next = selector(state);

    return equal(prev.current, next) ? (prev.current as U) : (prev.current = next);
  };
};
```

<Callout>
    **JSON.stringify**

    ì—¬ê¸°ì„  ê°„ë‹¨í•˜ê²Œ ë¹„êµí•˜ê¸° ìœ„í•´ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. ê°ì²´ê°€ ê¹Šì–´ì§€ë©´ ë¹„íš¨ìœ¨ì ì¸ ì—°ì‚°ì´ ë˜ê¸° ë•Œë¬¸ì— `Zustand`ì—ì„œëŠ” ìì²´ êµ¬í˜„í•œ [shallow](https://github.com/pmndrs/zustand/blob/main/src/vanilla/shallow.ts) í•¨ìˆ˜ë¥¼ í†µí•´ì„œ ë¹„êµ ì—°ì‚°ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
</Callout>

ì´ì „ ê°’ì„ `useShallow` ì† `prev`ì— ì €ì¥í•œ í›„ ìƒˆë¡œ ë“¤ì–´ì˜¤ëŠ” `next`ì™€ ë¹„êµí•´ì„œ ë™ì¼í•˜ë‹¤ë©´ ì´ì „ ê°’ì„ ë°˜í™˜í•˜ê³ , ë‹¤ë¥´ë‹¤ë©´ ìƒˆ ê°’ì„ ë°˜í™˜í•©ë‹ˆë‹¤.

ì´ì œ ë¬¸ì œì—†ì´ ê°ì²´ì˜ ì—¬ëŸ¬ ê°’ì„ í•œë²ˆì— êµ¬ë…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx Person.tsx
const store = createStore({
  name: 'ê¹€ë„í˜„',
  age: 0,
});

const Person = () => {
  const { name, age } = useStore(
    store,
    // !mark
    useShallow((state) => ({ name: state.name, age: state.age }))
  );

  const increase = () => {
    store.setState((prev) => ({ ...prev, age: prev.age + 1 }));
  };

  return (
    <>
      <div>Name: {name}</div>
      <div>Age: {age}</div>
      <button onClick={increase}>Increase Button</button>
    </>
  );
};
```

<Example4 />
